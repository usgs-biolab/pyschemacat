# pyschemacat

The immediate problem we are trying to solve with this package is to build a map initialization file for a TerriaJS-based mapper using metadata from one or another of the catalogs where we have mappable items. The seminal use case was to build a catalog for a given organizational group in USGS.

There are lots of ways to go about this, but we thought we would try to stick with a set of core principles involving open standards and some technologies in current development by some of our earth science colleagues. At the end of the day, we want to execute a piece of code to query a catalog for data of interest, examine the distribution routes available for the items returned to determine which of them are mappable, and then use the metadata returned to lay out a logical catalog for some other platform. In the first case we are working on, we are building a [TerriaJS initialization file](https://docs.terria.io/guide/customizing/initialization-files/) because we happen to be using that platform on our maps.usgs.gov domain. However, we are trying to build this in a way that it can be extensible for other cases.

One question we worked through was, why not just use CSW (Open Geospatial Consortium Catalog Service for Web). Platforms like TerriaJS support CSW out of the box, so we can certainly set up to operate directly with a CSW search to pull back the items we want. However, if the CSW end point does not support all the query parameters we need or does not return records in a sufficiently robust format to give us the information we want to have in our map catalog, then it's not really going to work. In our test case, we are trying to build items found in the [ScienceBase](https://www.sciencebase.gov) catalog, which does support a rudimentary CSW search interface. However, we cannot pass the complete set of specific search parameters we need to use, and the response formats (CSW Record/Dublin Core or ISO19139 XML) do not really have the complete set of information we would want to use for organizing and laying out our logical catalog.

So, we are going to explore options that use CSW as at least the logical starting point to query for and return items from a source catalog, but we are going to combine methods that leverage schema.org metadata from the source catalog landing pages as the base source for mappable item metadata. We're doing this partly out of intellectual curiosity after watching developments with the EarthCube Project 418 and Geocodes work along with Google Dataset Search. The schema.org specification and methods for embedding structured metadata in landing pages seems mature enough, but we wondered just how ready the operational environment of ScienceBase or other catalogs/repositories are for this to actually work.

## Approach

To build this system, we can essentially break our problem into a few logical parts:

1. How do we query a catalog interface for the assets we want to work with using some type of topical search parameters?
2. How do we obtain the best structured representation of the metadata for items of interest?
3. How do we determine what data assets in our list have some type of mappable distribution point that we can access through a map tool like TerriaJS?
4. How can we generalize a process for laying out a logical catalog organization using inherent metadata in our selected items?

In the schema.org metadata paradigm where some type of processing code like we are building here needs to figure out what to go after, the approach might be to use a sitemap or set of sitemaps to direct the process. Those are essentially just providing the list of URLs to go after with further processing. As catalogs get really big (ScienceBase has over 9 million items), we need some other approach that lets us run a search of some kind to return the subset of things we want to pull together. The simplest way to solve our problem here, of course would be to just use the ScienceBase API (either REST or with the sciencebasepy package), query for the items we want, specify the fields we want returned, and then generate our map catalog. That would be quick and efficient but also completely customized to just this one specific use case. We couldn't extend this to some other catalog like data.gov NOAA One Stop. What we are going to attempt to do initially is start our top level search using the CSW service provided by ScienceBase to retrieve a larger batch of items than we will probably be able to use in the end. The purpose of that first query is still just to give us the items for whose schema.org metadata we want to go after.

For the second issue, there are all kinds of structured metadata schemas that could work for what we are after, with the most popular in our domain consisting of the ISO19115 family of standards, the older FGDC CSDGM standard, or even simpler possibilities such as Atom+RSS that might have enough information to work from. ScienceBase provides all of these as do most of the other catalogs we are interested in testing, but they all come with some issues in terms of the quality and completeness of contents in those standards or confusion between them that create challenges anyway. Plus, we have this curiosity about what schema.org approaches might be useful for in a use case like this and we want to explore that direction.

The third issue is likely to be one of the more challenging to solve as there is really not a thoroughly adopted way of identifying what exactly a given distribution URL type is according to any kind of semantic standard. All the systems in our space are doing basic pattern recognition on URL strings to guess what things are, and some go so far as to hit the URL with a request to try and determine what it really is. We'll explore those options in this work.

The last thing is also an interesting one to think about. In our notional use case for building this tool, we've been exploring other ways of building a TerriaJS initialization file. We've ended up using the features TerriaJS provided in their system to lay out what might be a fairly complex structure that uses parts of the metadata to lay out a logical hierarchy of containers and data items that are conducive for browsing in a particular context. It would be easy just to spit everything out in a long list, but we are curious about how good the descriptive metadata are in our cases and how we might be able to exploit the information in the items to generate some type of logical browse structure to the map catalog.
